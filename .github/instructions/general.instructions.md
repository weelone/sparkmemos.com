---
applyTo: "**"
---

# sparkmemos.com â€“ Repo quick reference

A compact map of the project for fast onboarding and future AI reads. Keep this up to date when structure or configs change.

## Stack

- Framework: Next.js 15 (App Router, MDX enabled)
- Runtime: Edge for app/[lang]/layout
- Language: TypeScript (strict), React 19
- Styling: Tailwind CSS v4 (via @tailwindcss/postcss), PostCSS 8, autoprefixer
- Content: MDX, Velite (content pipeline, rehype-pretty-code)
- Icons/animation: lucide-react, framer-motion

## Scripts

- dev: next dev
- build: next build (triggers Velite build via next.config.mjs)
- start: next start
- lint: next lint

## Key paths

- App entry: `app/[lang]/(main)/page.tsx`, with `app/[lang]/layout.tsx`
- Static SEO: `app/robots.ts`, `app/sitemap.ts`
- Global CSS: `app/globals.css`
- Dictionaries (i18n labels + metadata): `dictionaries/`
- Blog content source: `blog/`
  - Posts: `blog/posts/**/*.md` (one file per language)
  - Categories: `blog/categories/*.yml`
  - Tags index: `blog/tags/index.yml`
- Velite config: `velite.config.ts` (outputs `.velite` data + `public/static/posts` assets)
- Metadata constants: `constants/metadata.ts`
- MDX components mapping: `mdx-components.tsx`
- Middleware (locale redirect): `middleware.ts`

## Routing and i18n

- Supported languages: en, zh, es, de, fr, it, ja, ko (default: en)
- Locale prefix required: `/{lang}/...` (middleware redirects `/`, `/terms`, `/privacy` to preferred locale)
- Blog routes (generated by content):
  - Post: `/{lang}/blog/{slug}`
  - Category: `/{lang}/blog/categories/{slug}`
  - Tag: `/{lang}/blog/tags/{slug}`
- Notable pages under `app/[lang]/(main)/`:
  - Home: `page.tsx`
  - Blog index: `blog/page.tsx`
  - Blog post: `blog/[postSlug]/page.tsx`
  - Category page: `blog/categories/[categorySlug]/page.tsx`
  - Terms/Privacy: `terms/page.mdx`, `privacy/page.mdx`

## Content pipeline (Velite)

- Root: `blog`
- Collections: posts (MD), categories (YAML), tags (YAML)
- Post frontmatter (required): `title`, `slug`, `lang`, `date`, `categories`
  - Optional: `updated`, `cover`, `video`, `description`, `keywords`, `draft`, `featured`, `tags` (default []), `metadata`
- Derived fields:
  - Post permalink: `/${lang}/blog/${slug}`
  - Category/tag permalinks for all languages
  - Category/tag counts computed per language during prepare()
- Output:
  - Data JSON: `.velite`
  - Assets: `public/static/posts` (served under `/static/posts/`)
- Build hooks: next.config.mjs runs `velite.build({ watch: isDev, clean: !isDev })` once per process (guarded by `VELITE_STARTED`)

## SEO/metadata

- `generateMetadata` (in `app/[lang]/layout.tsx`) reads from dictionaries + `METADATA`
- OpenGraph/Twitter images: `/social-banner.png`
- App Store: `constants/metadata.ts` (appId + tracking link)
- Alternates: `lib/metadata.ts#getAlternateLanguages` builds `alternates.languages` including `x-default`

## Styling

- Tailwind v4 via PostCSS plugin `@tailwindcss/postcss`
- Typography plugin: `@tailwindcss/typography`
- Global styles in `app/globals.css`

## Misc

- `_routes.json` excludes some static assets from routing cache rules
- `mdx-components.tsx` currently passes through components (extend here if needed)

## Common tasks

- Add a blog post: create `blog/posts/{YYYY-MM-DD some-title}/{lang}.md` with frontmatter; ensure `categories`/`tags` exist
- Add a category: edit `blog/categories/*.yml` (slug must be unique; `s.slug('blog', ["admin","login"])` reserved)
- Add a language: add `dictionaries/{lang}.ts` and update `dictionaries/index.ts`
- App metadata tweaks: `dictionaries/*` and `constants/metadata.ts`

## Gotchas

- Missing categories/tags cause build to fail (Velite prepare() hard-checks unexpected values)
- Locale prefix is mandatory; middleware only matches `/`, `/terms`, `/privacy`
- Edge runtime constraints apply to `app/[lang]/layout.tsx`

## Version snapshot

- next: 15.5.0
- react: ^19
- typescript: ^5
- tailwindcss: ^4.1.12
- postcss: ^8
- velite: ^0.2.4
